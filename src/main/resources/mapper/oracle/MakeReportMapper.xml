<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//com.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mobigen.snet.supportagent.dao.MakeReportMapper">
	<delete id="deleteReportBranch">
		DELETE FROM	SNET_REPORT_BRANCH
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>
	
	<delete id="deleteReportBranchSwType">
		DELETE FROM	SNET_REPORT_BRANCH_SW_TYPE
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>
	
	<delete id="deleteReportHostIp">
		DELETE FROM	SNET_REPORT_HOST_IP
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>
	
	<delete id="deleteReportHostIpSwType">
		DELETE FROM	SNET_REPORT_HOST_IP_SW_TYPE
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>
	
	<delete id="deleteReportSwNm">
		DELETE FROM	SNET_REPORT_SW_NM
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>
	
	<delete id="deleteReportSwType">
		DELETE FROM	SNET_REPORT_SW_TYPE
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>
	
	<delete id="deleteReportSwWeak">
		DELETE FROM	SNET_REPORT_SW_WEAK
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>

	<delete id="deleteReportBranchSwWeak">
		DELETE FROM	SNET_REPORT_BRANCH_SW_WEAK
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>
	
	<delete id="deleteReportTeam">
		DELETE FROM	SNET_REPORT_TEAM
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>
	
	<delete id="deleteReportTeamSwType">
		DELETE FROM	SNET_REPORT_TEAM_SW_TYPE
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</delete>

	<insert id="insertReportBranch">
		INSERT INTO SNET_REPORT_BRANCH
		(
		   CDATE         
		   , BRANCH_ID     
		   , BRANCH_NM     
		   , AUDIT_RATE    
		   , AD_RESULT_OK  
		   , AD_RESULT_NOK 
		   , AD_RESULT_NA  
		   , AD_RESULT_PASS
		   , AD_RESULT_REQ
		   , AD_WEIGHT_TOTAL
		   , AD_WEIGHT_OK   
		   , AD_WEIGHT_NOK  
		   , AD_WEIGHT_PASS 
		   , AD_WEIGHT_NA
		   , AD_WEIGHT_REQ
		   , ASSET_CNT 
		   , ASSET_SW_CNT 
		)
		SELECT
		   TO_CHAR(SYSDATE, 'YYYYMMDD') AS CDATE
		   , SAM.BRANCH_ID
		   , 
		   (
		     SELECT BRANCH_NM 
			 FROM SNET_CONFIG_TEAM_VIEW
			 WHERE BRANCH_ID = SAM.BRANCH_ID
			 GROUP BY BRANCH_ID, BRANCH_NM
		   ) AS BRANCH_NM
		   , ROUND(decode((SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100, 0, 0, null, 0,SUM(A.AD_WEIGHT_OK)/(SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100),2) AS AUDIT_RATE
		   , SUM(A.AD_RESULT_OK) AS AD_RESULT_OK     
		   , SUM(A.AD_RESULT_NOK) AS AD_RESULT_NOK
		   , SUM(A.AD_RESULT_NA) AS AD_RESULT_NA
		   , SUM(A.AD_RESULT_PASS) AS AD_RESULT_PASS
		   , SUM(A.AD_RESULT_REQ) AS AD_RESULT_REQ
		   , SUM(A.AD_WEIGHT_TOTAL) AS AD_WEIGHT_TOTAL
		   , SUM(A.AD_WEIGHT_OK) AS AD_WEIGHT_OK
		   , SUM(A.AD_WEIGHT_NOK) AS AD_WEIGHT_NOK 
		   , SUM(A.AD_WEIGHT_PASS) AS AD_WEIGHT_PASS
		   , SUM(A.AD_WEIGHT_NA) AS AD_WEIGHT_NA
		   , SUM(A.AD_WEIGHT_REQ) AS AD_WEIGHT_REQ
	   	   , (  
				SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
				  FROM SNET_ASSET_SW_AUDIT_HISTORY C
				  , SNET_ASSET_SW_AUDIT_DAY D
				  , SNET_ASSET_MASTER F
				 WHERE 1=1
				AND C.ASSET_CD 	= D.ASSET_CD
				AND C.ASSET_CD  = F.ASSET_CD
				AND C.AUDIT_DAY = D.AUDIT_DAY
				AND C.SW_TYPE 	= D.SW_TYPE
				AND C.SW_NM 	= D.SW_NM
				AND C.SW_DIR 	= D.SW_DIR
				AND C.SW_USER 	= D.SW_USER
				AND C.SW_ETC 	= D.SW_ETC				
				AND F.BRANCH_ID = SAM.BRANCH_ID
				AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
			 ) AS ASSET_CNT
			 ,
			 (
				SELECT COUNT(*) AS CNT
				  FROM SNET_ASSET_SW_AUDIT_HISTORY C
				  , SNET_ASSET_SW_AUDIT_DAY D
				  , SNET_ASSET_MASTER F
				 WHERE 1=1
				AND C.ASSET_CD 	= D.ASSET_CD
				AND C.ASSET_CD = F.ASSET_CD
				AND C.AUDIT_DAY = D.AUDIT_DAY
				AND C.SW_TYPE 	= D.SW_TYPE
				AND C.SW_NM 	= D.SW_NM
				AND C.SW_DIR 	= D.SW_DIR
				AND C.SW_USER 	= D.SW_USER
				AND C.SW_ETC 	= D.SW_ETC				
				AND F.BRANCH_ID = SAM.BRANCH_ID
				AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
			 ) AS ASSET_SW_CNT		   
		FROM SNET_ASSET_SW_AUDIT_HISTORY A
			, SNET_ASSET_SW_AUDIT_DAY B
			, SNET_ASSET_MASTER SAM
		WHERE SAM.BRANCH_ID IS NOT NULL
			AND A.ASSET_CD 	= B.ASSET_CD
			AND SAM.ASSET_CD = A.ASSET_CD
			AND A.AUDIT_DAY = B.AUDIT_DAY
			AND A.SW_TYPE 	= B.SW_TYPE
			AND A.SW_NM 	= B.SW_NM
			AND A.SW_DIR 	= B.SW_DIR
            AND A.SW_USER 	= B.SW_USER
            AND A.SW_ETC 	= B.SW_ETC
			AND A.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
		GROUP BY SAM.BRANCH_ID
	</insert>
	
	<select id="selectReportBranch" resultType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		SELECT 
		BRANCH_ID AS branchId
		FROM SNET_REPORT_BRANCH
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</select>
	
	<update id="updateReportBranchCnt" parameterType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		UPDATE 	SNET_REPORT_BRANCH SET
		ASSET_CNT = (
			SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
				  FROM SNET_ASSET_SW_AUDIT_HISTORY C
				  , SNET_ASSET_SW_AUDIT_DAY D
				  , SNET_ASSET_MASTER F
				 WHERE 1=1
				AND C.ASSET_CD 	= D.ASSET_CD
				AND C.ASSET_CD  = F.ASSET_CD
				AND C.AUDIT_DAY = D.AUDIT_DAY
				AND C.SW_TYPE 	= D.SW_TYPE
				AND C.SW_NM 	= D.SW_NM
				AND C.SW_DIR 	= D.SW_DIR
				AND C.SW_USER 	= D.SW_USER
				AND C.SW_ETC 	= D.SW_ETC				
				AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
				AND C.BRANCH_ID =#{branchId}
		)
		, ASSET_SW_CNT = 
		(
			SELECT COUNT(*) AS CNT
				  FROM SNET_ASSET_SW_AUDIT_HISTORY C
				  , SNET_ASSET_SW_AUDIT_DAY D
				  , SNET_ASSET_MASTER F
				 WHERE 1=1
				AND C.ASSET_CD 	= D.ASSET_CD
				AND C.ASSET_CD = F.ASSET_CD
				AND C.AUDIT_DAY = D.AUDIT_DAY
				AND C.SW_TYPE 	= D.SW_TYPE
				AND C.SW_NM 	= D.SW_NM
				AND C.SW_DIR 	= D.SW_DIR
				AND C.SW_USER 	= D.SW_USER
				AND C.SW_ETC 	= D.SW_ETC				
				AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
				AND F.BRANCH_ID = #{branchId}
		)
		WHERE 
			CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
			AND BRANCH_ID = #{branchId}	
	</update>
	
	<insert id="insertReportBranchSwType">
		INSERT INTO SNET_REPORT_BRANCH_SW_TYPE
		(
		   CDATE         
		   , BRANCH_ID     
		   , BRANCH_NM
		   , SW_TYPE   
		   , AUDIT_RATE 
		   , AD_RESULT_OK  
		   , AD_RESULT_NOK 
		   , AD_RESULT_NA  
		   , AD_RESULT_PASS
		   , AD_RESULT_REQ
		   , AD_WEIGHT_TOTAL
		   , AD_WEIGHT_OK   
		   , AD_WEIGHT_NOK  
		   , AD_WEIGHT_PASS 
		   , AD_WEIGHT_NA
		   , AD_WEIGHT_REQ
		   , ASSET_CNT
		   , ASSET_SW_CNT
		)
		SELECT
		   TO_CHAR(SYSDATE, 'YYYYMMDD') AS CDATE
		   , SAM.BRANCH_ID
		   , 
		   (
		     SELECT BRANCH_NM 
			 FROM SNET_CONFIG_TEAM_VIEW
			 WHERE BRANCH_ID = SAM.BRANCH_ID
			 GROUP BY BRANCH_ID, BRANCH_NM
		   ) AS BRANCH_NM
		   , A.SW_TYPE
		   , ROUND(decode((SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100, 0, 0, null, 0,SUM(A.AD_WEIGHT_OK)/(SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100),2) AS AUDIT_RATE
		   , SUM(A.AD_RESULT_OK) AS AD_RESULT_OK     
		   , SUM(A.AD_RESULT_NOK) AS AD_RESULT_NOK
		   , SUM(A.AD_RESULT_NA) AS AD_RESULT_NA
		   , SUM(A.AD_RESULT_PASS) AS AD_RESULT_PASS
		   , SUM(A.AD_RESULT_REQ) AS AD_RESULT_REQ
		   , SUM(A.AD_WEIGHT_TOTAL) AS AD_WEIGHT_TOTAL
		   , SUM(A.AD_WEIGHT_OK) AS AD_WEIGHT_OK
		   , SUM(A.AD_WEIGHT_NOK) AS AD_WEIGHT_NOK 
		   , SUM(A.AD_WEIGHT_PASS) AS AD_WEIGHT_PASS
		   , SUM(A.AD_WEIGHT_NA) AS AD_WEIGHT_NA  
		   , SUM(A.AD_WEIGHT_REQ) AS AD_WEIGHT_REQ  
	   	   , (  
				SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
				  FROM SNET_ASSET_SW_AUDIT_HISTORY C
				  , SNET_ASSET_SW_AUDIT_DAY D
				  , SNET_ASSET_MASTER F
				 WHERE 1=1
				AND C.ASSET_CD 	= D.ASSET_CD
				AND C.ASSET_CD = F.ASSET_CD
				AND C.AUDIT_DAY = D.AUDIT_DAY
				AND C.SW_TYPE 	= D.SW_TYPE
				AND C.SW_NM 	= D.SW_NM
				AND C.SW_DIR 	= D.SW_DIR
				AND C.SW_USER 	= D.SW_USER
				AND C.SW_ETC 	= D.SW_ETC				
				AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
				AND C.SW_TYPE = A.SW_TYPE
				AND F.BRANCH_ID = SAM.BRANCH_ID
			 ) AS ASSET_CNT
			 ,
			 (
				SELECT COUNT(*) AS CNT
				  FROM SNET_ASSET_SW_AUDIT_HISTORY C
				  , SNET_ASSET_SW_AUDIT_DAY D
				  , SNET_ASSET_MASTER F
				 WHERE 1=1
				AND C.ASSET_CD 	= D.ASSET_CD
				AND C.ASSET_CD = F.ASSET_CD
				AND C.AUDIT_DAY = D.AUDIT_DAY
				AND C.SW_TYPE   = D.SW_TYPE
				AND C.SW_NM 	= D.SW_NM
				AND C.SW_DIR 	= D.SW_DIR
				AND C.SW_USER 	= D.SW_USER
				AND C.SW_ETC 	= D.SW_ETC				
				AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
				AND C.SW_TYPE = A.SW_TYPE
				AND F.BRANCH_ID = SAM.BRANCH_ID
			 ) AS ASSET_SW_CNT	
	   
		FROM SNET_ASSET_SW_AUDIT_HISTORY A
			, SNET_ASSET_SW_AUDIT_DAY B
			, SNET_ASSET_MASTER SAM
		WHERE SAM.BRANCH_ID IS NOT NULL
			AND A.ASSET_CD 	= B.ASSET_CD
			AND A.AUDIT_DAY = B.AUDIT_DAY
			AND A.SW_TYPE 	= B.SW_TYPE
			AND A.SW_NM 	= B.SW_NM
			AND A.SW_DIR 	= B.SW_DIR
            AND A.SW_USER 	= B.SW_USER
            AND A.SW_ETC 	= B.SW_ETC
			AND A.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
			AND SAM.ASSET_CD = A.ASSET_CD
		GROUP BY SAM.BRANCH_ID, A.SW_TYPE
	</insert>
	
	<select id="selectReportBranchSwType" resultType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		SELECT 
			BRANCH_ID as branchId
			, SW_TYPE as swType
		FROM SNET_REPORT_BRANCH_SW_TYPE
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</select>
	
	<update id="updateReportBranchSwType" parameterType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		UPDATE 	SNET_REPORT_BRANCH_SW_TYPE SET
		ASSET_CNT = (
		SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
			  FROM SNET_ASSET_SW_AUDIT_HISTORY C
			  , SNET_ASSET_SW_AUDIT_DAY D
			  , SNET_ASSET_MASTER F
			 WHERE 1=1
			AND C.ASSET_CD 	= D.ASSET_CD
			AND C.ASSET_CD  = F.ASSET_CD
			AND C.AUDIT_DAY = D.AUDIT_DAY
			AND C.SW_TYPE 	= D.SW_TYPE
			AND C.SW_NM 	= D.SW_NM
			AND C.SW_DIR 	= D.SW_DIR
			AND C.SW_USER 	= D.SW_USER
			AND C.SW_ETC 	= D.SW_ETC			
			AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
			AND F.BRANCH_ID = #{branchId}
			AND C.SW_TYPE   = #{swType}
		)
		, ASSET_SW_CNT = 
		(
		
			SELECT COUNT(*) AS CNT
			  FROM SNET_ASSET_SW_AUDIT_HISTORY C
			  , SNET_ASSET_SW_AUDIT_DAY D
			  , SNET_ASSET_MASTER F
			 WHERE 1=1
			AND C.ASSET_CD 	= D.ASSET_CD
			AND C.ASSET_CD  = F.ASSET_CD
			AND C.AUDIT_DAY = D.AUDIT_DAY
			AND C.SW_TYPE   = D.SW_TYPE
			AND C.SW_NM 	= D.SW_NM
			AND C.SW_DIR 	= D.SW_DIR
			AND C.SW_USER 	= D.SW_USER
			AND C.SW_ETC 	= D.SW_ETC			
			AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')			
			AND F.BRANCH_ID = #{branchId}
			AND C.SW_TYPE   = #{swType}
		)
		WHERE 
			CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
			AND BRANCH_ID = #{branchId}
			AND SW_TYPE   = #{swType}			
	
	</update>
	
	<insert id="insertReportHostIp">
		INSERT INTO SNET_REPORT_HOST_IP
		(
			CDATE         
			, BRANCH_ID     
			, BRANCH_NM
			, TEAM_ID
			, TEAM_NM
			, USER_ID
			, USER_NM
			, HOST_NM
			, IP_ADDRESS
			, AUDIT_RATE 
			, AD_RESULT_OK  
			, AD_RESULT_NOK 
			, AD_RESULT_NA  
			, AD_RESULT_PASS
			, AD_RESULT_REQ
			, AD_WEIGHT_TOTAL
			, AD_WEIGHT_OK   
			, AD_WEIGHT_NOK  
			, AD_WEIGHT_PASS 
			, AD_WEIGHT_NA
			, AD_WEIGHT_REQ
			, ASSET_CNT 
			, ASSET_SW_CNT
		)
		SELECT
		   TO_CHAR(SYSDATE, 'YYYYMMDD') AS CDATE
		   , SAM.BRANCH_ID
		   , 
		   (
			 SELECT BRANCH_NM 
			 FROM SNET_CONFIG_TEAM_VIEW
			 WHERE BRANCH_ID = SAM.BRANCH_ID
			 GROUP BY BRANCH_ID, BRANCH_NM
		   ) AS BRANCH_NM		   
		   , SAM.TEAM_ID
		   ,
		   (
			 SELECT TEAM_NM 
			 FROM SNET_CONFIG_TEAM_VIEW
			 WHERE TEAM_ID = SAM.TEAM_ID
		   ) AS TEAM_NM			   
		   , SAU.USER_ID 
		   , SAU.USER_NM 
		   , SAM.HOST_NM 
		   , SAM.IP_ADDRESS
		   , ROUND(decode((SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100, 0, 0, null, 0,SUM(A.AD_WEIGHT_OK)/(SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100),2) AS AUDIT_RATE
		   , SUM(A.AD_RESULT_OK) AS AD_RESULT_OK     
		   , SUM(A.AD_RESULT_NOK) AS AD_RESULT_NOK
		   , SUM(A.AD_RESULT_NA) AS AD_RESULT_NA
		   , SUM(A.AD_RESULT_PASS) AS AD_RESULT_PASS
		   , SUM(A.AD_RESULT_REQ) AS AD_RESULT_REQ
		   , SUM(A.AD_WEIGHT_TOTAL) AS AD_WEIGHT_TOTAL
		   , SUM(A.AD_WEIGHT_OK) AS AD_WEIGHT_OK
		   , SUM(A.AD_WEIGHT_NOK) AS AD_WEIGHT_NOK 
		   , SUM(A.AD_WEIGHT_PASS) AS AD_WEIGHT_PASS
		   , SUM(A.AD_WEIGHT_NA) AS AD_WEIGHT_NA
		   , SUM(A.AD_WEIGHT_REQ) AS AD_WEIGHT_REQ
		   ,
			 (  
				SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
				  FROM SNET_ASSET_SW_AUDIT_HISTORY C
				  , SNET_ASSET_SW_AUDIT_DAY D
				  , SNET_ASSET_MASTER F
				 WHERE 1=1
				AND C.ASSET_CD 	= D.ASSET_CD
				AND F.ASSET_CD  =  C.ASSET_CD
				AND C.AUDIT_DAY = D.AUDIT_DAY
				AND C.SW_TYPE 	= D.SW_TYPE
				AND C.SW_NM 	= D.SW_NM
				AND C.SW_DIR 	= D.SW_DIR
				AND C.SW_USER 	= D.SW_USER
				AND C.SW_ETC 	= D.SW_ETC				
				AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
				AND F.BRANCH_ID = SAM.BRANCH_ID
				AND F.TEAM_ID = SAM.TEAM_ID
				AND F.HOST_NM = SAM.HOST_NM
				AND F.IP_ADDRESS = SAM.IP_ADDRESS  
			 ) AS ASSET_CNT
			 ,
			 (
				SELECT COUNT(*) AS CNT
				  FROM SNET_ASSET_SW_AUDIT_HISTORY C
				  , SNET_ASSET_SW_AUDIT_DAY D
				  , SNET_ASSET_MASTER F
				 WHERE 1=1
				AND C.ASSET_CD 	= D.ASSET_CD
				AND F.ASSET_CD   =  C.ASSET_CD
				AND C.AUDIT_DAY  = D.AUDIT_DAY
				AND C.SW_TYPE 	= D.SW_TYPE
				AND C.SW_NM 		= D.SW_NM
				AND C.SW_DIR 	= D.SW_DIR
				AND C.SW_USER 	= D.SW_USER
				AND C.SW_ETC 	= D.SW_ETC				
				AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
				AND F.BRANCH_ID = SAM.BRANCH_ID
				AND F.TEAM_ID = SAM.TEAM_ID
				AND F.HOST_NM = SAM.HOST_NM
				AND F.IP_ADDRESS = SAM.IP_ADDRESS  
			 ) AS ASSET_SW_CNT
		FROM SNET_ASSET_SW_AUDIT_HISTORY A
			, SNET_ASSET_SW_AUDIT_DAY B
			, SNET_ASSET_USER SAU
			, SNET_ASSET_MASTER SAM
		WHERE SAM.BRANCH_ID IS NOT NULL
			AND A.ASSET_CD 	= B.ASSET_CD
			AND A.ASSET_CD  = SAM.ASSET_CD
			AND A.ASSET_CD  = SAU.ASSET_CD
			AND A.AUDIT_DAY = B.AUDIT_DAY
			AND A.SW_TYPE 	= B.SW_TYPE
			AND A.SW_NM 	= B.SW_NM
			AND A.SW_DIR 	= B.SW_DIR
			AND A.SW_USER 	= B.SW_USER
			AND A.SW_ETC 	= B.SW_ETC
			AND SAU.USER_TYPE='OP'
			AND A.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
		GROUP BY 
			SAM.BRANCH_ID
			, SAM.TEAM_ID
			, SAM.HOST_NM
			, SAU.USER_ID 
			, SAU.USER_NM 
			, SAM.IP_ADDRESS
	</insert>
	
	<select id="selectReportHostIp" resultType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		SELECT 
			BRANCH_ID as branchId
			, TEAM_ID as teamId
			, HOST_NM as hostNm
			, IP_ADDRESS as ipAddress
		FROM SNET_REPORT_HOST_IP
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</select>
	
	<update id="updateReportHostIp" parameterType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		UPDATE SNET_REPORT_HOST_IP SET
			        ASSET_CNT = (  
						SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
						  FROM SNET_ASSET_SW_AUDIT_HISTORY C
						  , SNET_ASSET_SW_AUDIT_DAY D
						  , SNET_ASSET_MASTER F
						 WHERE 1=1
						AND C.ASSET_CD 	= D.ASSET_CD
						AND F.ASSET_CD   =  C.ASSET_CD
						AND C.AUDIT_DAY  = D.AUDIT_DAY
						AND C.SW_TYPE 	= D.SW_TYPE
						AND C.SW_NM 		= D.SW_NM
						AND C.SW_DIR 	= D.SW_DIR
						AND C.SW_USER 	= D.SW_USER
						AND C.SW_ETC 	= D.SW_ETC						
						AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
						AND F.BRANCH_ID = #{branchId}
						AND C.TEAM_ID = #{teamId}
						AND C.HOST_NM = #{hostNm}
						AND C.IP_ADDRESS = #{ipAddress}    
			         )  
					 ,
					ASSET_SW_CNT = (
						SELECT COUNT(*) AS CNT
							FROM SNET_ASSET_SW_AUDIT_HISTORY C
						  , SNET_ASSET_SW_AUDIT_DAY D
						  , SNET_ASSET_MASTER F
						 WHERE 1=1
						AND C.ASSET_CD 	= D.ASSET_CD
						AND F.ASSET_CD  =  C.ASSET_CD
						AND C.AUDIT_DAY = D.AUDIT_DAY
						AND C.SW_TYPE 	= D.SW_TYPE
						AND C.SW_NM 	= D.SW_NM
						AND C.SW_DIR 	= D.SW_DIR
						AND C.SW_USER 	= D.SW_USER
						AND C.SW_ETC 	= D.SW_ETC						
						AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
						AND F.BRANCH_ID = #{branchId}
						AND C.TEAM_ID = #{teamId}
						AND C.HOST_NM = #{hostNm}
						AND C.IP_ADDRESS = #{ipAddress}  
					 ) 
		WHERE 
			CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
			AND BRANCH_ID = #{branchId}
			AND TEAM_ID = #{teamId}
			AND HOST_NM = #{hostNm}
			AND IP_ADDRESS = #{ipAddress}	
	
	</update>
	
	<insert id="insertReportHostIpSwType">
		INSERT INTO SNET_REPORT_HOST_IP_SW_TYPE
		(
			CDATE         
			, BRANCH_ID     
			, BRANCH_NM
			, TEAM_ID
			, TEAM_NM
			, USER_ID
			, USER_NM
			, HOST_NM
			, IP_ADDRESS
			, SW_TYPE
			, AUDIT_RATE 
			, AD_RESULT_OK  
			, AD_RESULT_NOK 
			, AD_RESULT_NA  
			, AD_RESULT_PASS
			, AD_RESULT_REQ
			, AD_WEIGHT_TOTAL
			, AD_WEIGHT_OK   
			, AD_WEIGHT_NOK  
			, AD_WEIGHT_PASS 
			, AD_WEIGHT_NA 
			, AD_WEIGHT_REQ
		)
		SELECT
		   TO_CHAR(SYSDATE, 'YYYYMMDD') AS CDATE
		   , SAM.BRANCH_ID
		   , 
		   (
			 SELECT BRANCH_NM 
			 FROM SNET_CONFIG_TEAM_VIEW
			 WHERE BRANCH_ID = SAM.BRANCH_ID
			 GROUP BY BRANCH_ID, BRANCH_NM
		   ) AS BRANCH_NM		   
		   , SAM.TEAM_ID
		   ,
		   (
			 SELECT TEAM_NM 
			 FROM SNET_CONFIG_TEAM_VIEW
			 WHERE TEAM_ID = SAM.TEAM_ID
		   ) AS TEAM_NM	
		   , SAU.USER_ID 
		   , SAU.USER_NM 
		   , SAM.HOST_NM 
		   , SAM.IP_ADDRESS
		   , A.SW_TYPE
		   , ROUND(decode((SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100, 0, 0, null, 0,SUM(A.AD_WEIGHT_OK)/(SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100),2) AS AUDIT_RATE
		   , SUM(A.AD_RESULT_OK) AS AD_RESULT_OK     
		   , SUM(A.AD_RESULT_NOK) AS AD_RESULT_NOK
		   , SUM(A.AD_RESULT_NA) AS AD_RESULT_NA
		   , SUM(A.AD_RESULT_PASS) AS AD_RESULT_PASS
		   , SUM(A.AD_RESULT_REQ) AS AD_RESULT_REQ
		   , SUM(A.AD_WEIGHT_TOTAL) AS AD_WEIGHT_TOTAL
		   , SUM(A.AD_WEIGHT_OK) AS AD_WEIGHT_OK
		   , SUM(A.AD_WEIGHT_NOK) AS AD_WEIGHT_NOK 
		   , SUM(A.AD_WEIGHT_PASS) AS AD_WEIGHT_PASS
		   , SUM(A.AD_WEIGHT_NA) AS AD_WEIGHT_NA 
		   , SUM(A.AD_WEIGHT_REQ) AS AD_WEIGHT_REQ 
		FROM SNET_ASSET_SW_AUDIT_HISTORY A
		, SNET_ASSET_SW_AUDIT_DAY B
		, SNET_ASSET_USER SAU
		, SNET_ASSET_MASTER SAM
		WHERE SAM.BRANCH_ID IS NOT NULL
			AND A.ASSET_CD 	 = B.ASSET_CD
			AND A.ASSET_CD   = SAM.ASSET_CD
			AND A.ASSET_CD   = SAU.ASSET_CD
			AND A.AUDIT_DAY  = B.AUDIT_DAY
			AND A.SW_TYPE 	= B.SW_TYPE
			AND A.SW_NM 	= B.SW_NM
			AND A.SW_DIR 	= B.SW_DIR
			AND A.SW_USER 	= B.SW_USER
			AND A.SW_ETC 	= B.SW_ETC			
			AND SAU.USER_TYPE = 'OP'
			AND A.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
		GROUP BY 
			SAM.BRANCH_ID
			, SAM.TEAM_ID
			, SAM.HOST_NM
			, SAU.USER_ID 
			, SAU.USER_NM 
			, SAM.IP_ADDRESS
			, A.SW_TYPE
	</insert>
	
	<insert id="insertReportSwNm">
		INSERT INTO SNET_REPORT_SW_NM
		(
			CDATE         
			, SW_TYPE
			, SW_NM
			, AUDIT_RATE 
			, AD_RESULT_OK  
			, AD_RESULT_NOK 
			, AD_RESULT_NA  
			, AD_RESULT_PASS
			, AD_RESULT_REQ
			, AD_WEIGHT_TOTAL
			, AD_WEIGHT_OK   
			, AD_WEIGHT_NOK  
			, AD_WEIGHT_PASS 
			, AD_WEIGHT_NA
			, AD_WEIGHT_REQ
			, ASSET_CNT
			, ASSET_SW_CNT 
		)
		SELECT
		   TO_CHAR(SYSDATE, 'YYYYMMDD') AS CDATE
		   , A.SW_TYPE
		   , A.SW_NM
		   , ROUND(decode((SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100, 0, 0, null, 0,SUM(A.AD_WEIGHT_OK)/(SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100),2) AS AUDIT_RATE
		   , SUM(A.AD_RESULT_OK) AS AD_RESULT_OK     
		   , SUM(A.AD_RESULT_NOK) AS AD_RESULT_NOK
		   , SUM(A.AD_RESULT_NA) AS AD_RESULT_NA
		   , SUM(A.AD_RESULT_PASS) AS AD_RESULT_PASS
		   , SUM(A.AD_RESULT_REQ) AS AD_RESULT_REQ
		   , SUM(A.AD_WEIGHT_TOTAL) AS AD_WEIGHT_TOTAL
		   , SUM(A.AD_WEIGHT_OK) AS AD_WEIGHT_OK
		   , SUM(A.AD_WEIGHT_NOK) AS AD_WEIGHT_NOK 
		   , SUM(A.AD_WEIGHT_PASS) AS AD_WEIGHT_PASS
		   , SUM(A.AD_WEIGHT_NA) AS AD_WEIGHT_NA 
		   , SUM(A.AD_WEIGHT_REQ) AS AD_WEIGHT_REQ 
		   ,
		   (
				SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
				FROM SNET_ASSET_SW_AUDIT_HISTORY C
				, SNET_ASSET_SW_AUDIT_DAY D
				, SNET_ASSET_MASTER F	
				   WHERE    
							C.ASSET_CD 	= D.ASSET_CD
						AND F.ASSET_CD 	= D.ASSET_CD
						AND C.SW_TYPE 	= D.SW_TYPE
						AND C.SW_NM 		= D.SW_NM
						AND C.AUDIT_DAY 	= D.AUDIT_DAY
						AND C.SW_DIR 	= D.SW_DIR
						AND C.SW_USER 	= D.SW_USER
						AND C.SW_ETC 	= D.SW_ETC
						AND C.SW_TYPE	= A.SW_TYPE		
						AND LOWER(C.SW_NM) 	= LOWER(A.SW_NM)
		   ) AS ASSET_CNT
		   ,
		   (
				SELECT COUNT(*) AS CNT
				FROM SNET_ASSET_SW_AUDIT_HISTORY C
				, SNET_ASSET_SW_AUDIT_DAY D		
				, SNET_ASSET_MASTER F	
				   WHERE    
							C.ASSET_CD 	= D.ASSET_CD
						AND F.ASSET_CD 	= D.ASSET_CD
						AND C.SW_TYPE 	= D.SW_TYPE
						AND C.SW_NM 		= D.SW_NM
						AND C.AUDIT_DAY 	= D.AUDIT_DAY
						AND C.SW_DIR 	= D.SW_DIR
						AND C.SW_USER 	= D.SW_USER
						AND C.SW_ETC 	= D.SW_ETC	
						AND C.SW_TYPE	= A.SW_TYPE
						AND LOWER(C.SW_NM) 	= LOWER(A.SW_NM)					
		   ) AS ASSET_SW_CNT
		FROM SNET_ASSET_SW_AUDIT_HISTORY A
		, SNET_ASSET_SW_AUDIT_DAY B
		, SNET_ASSET_MASTER SAM
		WHERE 
			A.ASSET_CD 	= B.ASSET_CD
			AND SAM.BRANCH_ID IS NOT NULL
			AND A.ASSET_CD  = SAM.ASSET_CD
			AND A.AUDIT_DAY = B.AUDIT_DAY
			AND A.SW_TYPE 	= B.SW_TYPE
			AND A.SW_NM 	= B.SW_NM
			AND A.SW_DIR 	= B.SW_DIR
			AND A.SW_USER 	= B.SW_USER
			AND A.SW_ETC 	= B.SW_ETC
			AND A.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE') 
		GROUP BY 
			A.SW_TYPE
			, A.SW_NM
	</insert>
	
	<select id="selectReportSwNm" resultType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		SELECT
			SW_TYPE as swType
			, SW_NM as swNm
		FROM SNET_REPORT_SW_NM
		WHERE 
		CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</select>
	
	<update id="updateReportSwNm" parameterType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		UPDATE 	SNET_REPORT_SW_NM SET
		ASSET_CNT = (
			SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
			FROM SNET_ASSET_SW_AUDIT_HISTORY C
			, SNET_ASSET_SW_AUDIT_DAY D
			, SNET_ASSET_MASTER F	
			   WHERE    
						C.ASSET_CD 	= D.ASSET_CD
					AND F.ASSET_CD 	= D.ASSET_CD
					AND C.SW_TYPE 	= D.SW_TYPE
					AND C.SW_NM 		= D.SW_NM
					AND C.AUDIT_DAY 	= D.AUDIT_DAY
					AND C.SW_DIR 	= D.SW_DIR
					AND C.SW_USER 	= D.SW_USER
					AND C.SW_ETC 	= D.SW_ETC
					AND C.SW_TYPE	= #{swType}	
					AND LOWER(C.SW_NM) 	= LOWER(#{swNm})
		)
		, ASSET_SW_CNT = 
		(
		
			SELECT COUNT(*) AS CNT
			FROM SNET_ASSET_SW_AUDIT_HISTORY C
			, SNET_ASSET_SW_AUDIT_DAY D
			, SNET_ASSET_MASTER F	
			   WHERE    
						C.ASSET_CD 	= D.ASSET_CD
					AND F.ASSET_CD 	= D.ASSET_CD
					AND C.SW_TYPE 	= D.SW_TYPE
					AND C.SW_NM 		= D.SW_NM
					AND C.AUDIT_DAY 	= D.AUDIT_DAY
					AND C.SW_DIR 	= D.SW_DIR
					AND C.SW_USER 	= D.SW_USER
					AND C.SW_ETC 	= D.SW_ETC
					AND C.SW_TYPE	= #{swType}	
					AND LOWER(C.SW_NM) 	= LOWER(#{swNm})
		)
		WHERE 
			CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
			AND SW_TYPE = #{swType}
			AND SW_NM   = #{swNm}
	</update>
	
	<insert id="insertReportSwType">
		INSERT INTO SNET_REPORT_SW_TYPE
		(
			CDATE         
			, SW_TYPE
			, AUDIT_RATE 
			, AD_RESULT_OK  
			, AD_RESULT_NOK 
			, AD_RESULT_NA  
			, AD_RESULT_PASS
			, AD_RESULT_REQ
			, AD_WEIGHT_TOTAL
			, AD_WEIGHT_OK   
			, AD_WEIGHT_NOK  
			, AD_WEIGHT_PASS 
			, AD_WEIGHT_NA 
			, AD_WEIGHT_REQ
			, ASSET_CNT
			, ASSET_SW_CNT
		)
		SELECT
		   TO_CHAR(SYSDATE, 'YYYYMMDD') AS CDATE
		   , A.SW_TYPE
		   , ROUND(decode((SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100, 0, 0, null, 0,SUM(A.AD_WEIGHT_OK)/(SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100),2) AS AUDIT_RATE
		   , SUM(A.AD_RESULT_OK) AS AD_RESULT_OK     
		   , SUM(A.AD_RESULT_NOK) AS AD_RESULT_NOK
		   , SUM(A.AD_RESULT_NA) AS AD_RESULT_NA
		   , SUM(A.AD_RESULT_PASS) AS AD_RESULT_PASS
		   , SUM(A.AD_RESULT_REQ) AS AD_RESULT_REQ
		   , SUM(A.AD_WEIGHT_TOTAL) AS AD_WEIGHT_TOTAL
		   , SUM(A.AD_WEIGHT_OK) AS AD_WEIGHT_OK
		   , SUM(A.AD_WEIGHT_NOK) AS AD_WEIGHT_NOK 
		   , SUM(A.AD_WEIGHT_PASS) AS AD_WEIGHT_PASS
		   , SUM(A.AD_WEIGHT_NA) AS AD_WEIGHT_NA
		   , SUM(A.AD_WEIGHT_REQ) AS AD_WEIGHT_REQ
		   ,
		   (
				SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
				FROM SNET_ASSET_SW_AUDIT_HISTORY C
				, SNET_ASSET_SW_AUDIT_DAY D
				, SNET_ASSET_MASTER F	
				   WHERE    
							C.ASSET_CD 	= D.ASSET_CD
						AND F.ASSET_CD 	= D.ASSET_CD
						AND C.SW_TYPE 	= D.SW_TYPE
						AND C.SW_NM 		= D.SW_NM
						AND C.AUDIT_DAY 	= D.AUDIT_DAY
						AND C.SW_DIR 	= D.SW_DIR
						AND C.SW_USER 	= D.SW_USER
						AND C.SW_ETC 	= D.SW_ETC
						AND LOWER(C.SW_TYPE) 	= LOWER(A.SW_TYPE)
		   ) AS ASSET_CNT
		   ,
		   (
				SELECT COUNT(*) AS CNT
				FROM SNET_ASSET_SW_AUDIT_HISTORY C
				, SNET_ASSET_SW_AUDIT_DAY D
				, SNET_ASSET_MASTER F	
				   WHERE    
							C.ASSET_CD 	= D.ASSET_CD
						AND F.ASSET_CD 	= D.ASSET_CD
						AND C.SW_TYPE 	= D.SW_TYPE
						AND C.SW_NM 		= D.SW_NM
						AND C.AUDIT_DAY 	= D.AUDIT_DAY
						AND C.SW_DIR 	= D.SW_DIR
						AND C.SW_USER 	= D.SW_USER
						AND C.SW_ETC 	= D.SW_ETC
						AND LOWER(C.SW_TYPE) 	= LOWER(A.SW_TYPE)
		   ) AS ASSET_SW_CNT		   
		FROM SNET_ASSET_SW_AUDIT_HISTORY A
		, SNET_ASSET_SW_AUDIT_DAY B
		, SNET_ASSET_MASTER SAM
		WHERE 
			A.ASSET_CD 	= B.ASSET_CD
			AND A.ASSET_CD  = SAM.ASSET_CD
			AND A.AUDIT_DAY = B.AUDIT_DAY
			AND A.SW_TYPE 	= B.SW_TYPE
			AND A.SW_NM 	= B.SW_NM
			AND A.SW_DIR 	= B.SW_DIR
			AND A.SW_USER 	= B.SW_USER
			AND A.SW_ETC 	= B.SW_ETC
			AND A.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
		GROUP BY A.SW_TYPE		
	</insert>
	
	<select id="selectReportSwType" resultType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		SELECT 
			SW_TYPE AS swType
		FROM SNET_REPORT_SW_TYPE
		WHERE 
		CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</select>
	
	<update id="updateReportSwType" parameterType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		UPDATE 	SNET_REPORT_SW_TYPE SET
		ASSET_CNT = (
			SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
			FROM SNET_ASSET_SW_AUDIT_HISTORY C
			, SNET_ASSET_SW_AUDIT_DAY D
			, SNET_ASSET_MASTER F	
			   WHERE    
						C.ASSET_CD 	= D.ASSET_CD
					AND F.ASSET_CD 	= D.ASSET_CD
					AND C.SW_TYPE 	= D.SW_TYPE
					AND C.SW_NM 	= D.SW_NM
					AND C.AUDIT_DAY = D.AUDIT_DAY
					AND C.SW_DIR 	= D.SW_DIR
					AND C.SW_USER 	= D.SW_USER
					AND C.SW_ETC 	= D.SW_ETC
					AND LOWER(C.SW_TYPE) 	= LOWER(#{swType})		
		)
		, ASSET_SW_CNT = 
		(
			SELECT COUNT(*) AS CNT
			FROM SNET_ASSET_SW_AUDIT_HISTORY C
			, SNET_ASSET_SW_AUDIT_DAY D
			, SNET_ASSET_MASTER F	
			   WHERE    
						C.ASSET_CD 	= D.ASSET_CD
					AND F.ASSET_CD 	= D.ASSET_CD
					AND C.SW_TYPE 	= D.SW_TYPE
					AND C.SW_NM 	= D.SW_NM
					AND C.AUDIT_DAY = D.AUDIT_DAY
					AND C.SW_DIR 	= D.SW_DIR
					AND C.SW_USER 	= D.SW_USER
					AND C.SW_ETC 	= D.SW_ETC
					AND LOWER(C.SW_TYPE) 	= LOWER(#{swType})	
		)
		WHERE 
			CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
			AND SW_TYPE = #{swType}	
	</update>
	
	<insert id="insertReportSwWeak">
		INSERT INTO SNET_REPORT_SW_WEAK 
		(
			CDATE,
            SW_TYPE,
            SW_NM,
            DIAGNOSIS_CD,
            ITEM_GRP_NM,
            ITEM_NM,
            ITEM_GRADE,
            WEAK_CNT
        )
	   SELECT   TO_CHAR(SYSDATE, 'YYYYMMDD') AS CDATE,
				A.SW_TYPE,
				A.SW_NM,
				A.DIAGNOSIS_CD,
				A.ITEM_GRP_NM,
				A.ITEM_NM,
				A.ITEM_GRADE,
				COUNT(*) AS WEAK_CNT
		FROM SNET_ASSET_SW_AUDIT_REPORT A
			, SNET_ASSET_SW_AUDIT_DAY B
			, SNET_ASSET_MASTER SAM
	 	WHERE   A.ASSET_CD = B.ASSET_CD
				AND SAM.ASSET_CD= A.ASSET_CD
				AND A.SW_TYPE 	= B.SW_TYPE
				AND A.SW_NM 	= B.SW_NM
				AND A.SW_DIR 	= B.SW_DIR
				AND A.SW_USER 	= B.SW_USER
				AND A.SW_ETC 	= B.SW_ETC				
				AND A.AUDIT_DAY = B.AUDIT_DAY
				AND A.ITEM_RESULT = 'F'
				AND A.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE', 'Pentest')
	   GROUP BY A.SW_TYPE,
				A.SW_NM,
				A.DIAGNOSIS_CD,
				A.ITEM_GRP_NM,
				A.ITEM_NM,
				A.ITEM_GRADE
	</insert>
	
	<insert id="insertReportBranchSwWeak">
		INSERT INTO SNET_REPORT_BRANCH_SW_WEAK
		(
			CDATE,
			BRANCH_ID,
			BRANCH_NM,
			SW_TYPE,
			SW_NM,
			DIAGNOSIS_CD,
			ITEM_GRP_NM,
			ITEM_NM,
			ITEM_GRADE,
			WEAK_CNT
		)
	  SELECT TO_CHAR (SYSDATE, 'YYYYMMDD') AS CDATE,
			 SAM.BRANCH_ID,
		   (
			 SELECT BRANCH_NM 
			 FROM SNET_CONFIG_TEAM_VIEW
			 WHERE BRANCH_ID = SAM.BRANCH_ID
			 GROUP BY BRANCH_ID, BRANCH_NM
		   ) AS BRANCH_NM,			
			 A.SW_TYPE,
			 A.SW_NM,
			 A.DIAGNOSIS_CD,
			 A.ITEM_GRP_NM,
			 A.ITEM_NM,
			 A.ITEM_GRADE,
			 COUNT(*) AS WEAK_CNT
		FROM SNET_ASSET_SW_AUDIT_REPORT A
			 , SNET_ASSET_SW_AUDIT_DAY B
			 , SNET_ASSET_MASTER SAM
	   WHERE     A.ASSET_CD = B.ASSET_CD
	   		 AND SAM.BRANCH_ID IS NOT NULL
	   		 AND SAM.ASSET_CD = A.ASSET_CD
			 AND A.SW_TYPE = B.SW_TYPE
			 AND A.SW_NM = B.SW_NM
			 AND A.SW_DIR = B.SW_DIR
			 AND A.SW_USER = B.SW_USER
			 AND A.SW_ETC = B.SW_ETC
			 AND A.AUDIT_DAY = B.AUDIT_DAY
			 AND A.ITEM_RESULT = 'F'
			 AND A.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
	GROUP BY SAM.BRANCH_ID,
			 A.SW_TYPE,
			 A.SW_NM,
			 A.DIAGNOSIS_CD,
			 A.ITEM_GRP_NM,
			 A.ITEM_NM,
			 A.ITEM_GRADE
	</insert>
	
	<insert id="insertReportTeam">
		INSERT INTO SNET_REPORT_TEAM
		(
			CDATE         
			, BRANCH_ID
			, BRANCH_NM
			, TEAM_ID
			, TEAM_NM
			, AUDIT_RATE 
			, AD_RESULT_OK  
			, AD_RESULT_NOK 
			, AD_RESULT_NA  
			, AD_RESULT_PASS
			, AD_RESULT_REQ
			, AD_WEIGHT_TOTAL
			, AD_WEIGHT_OK   
			, AD_WEIGHT_NOK  
			, AD_WEIGHT_PASS 
			, AD_WEIGHT_NA
			, AD_WEIGHT_REQ
			, ASSET_CNT 
			, ASSET_SW_CNT 
		)
		SELECT
		   TO_CHAR(SYSDATE, 'YYYYMMDD') AS CDATE
		   , SAM.BRANCH_ID
		   , (SELECT BRANCH_NM FROM SNET_CONFIG_TEAM_VIEW WHERE BRANCH_ID =SAM.BRANCH_ID AND TEAM_ID =SAM.TEAM_ID) as BRANCH_NM
		   , SAM.TEAM_ID
		   , (SELECT TEAM_NM FROM SNET_CONFIG_TEAM_VIEW WHERE BRANCH_ID =SAM.BRANCH_ID AND TEAM_ID =SAM.TEAM_ID) as TEAM_NM
		   , ROUND(decode((SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100, 0, 0, null, 0,SUM(A.AD_WEIGHT_OK)/(SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100),2) AS AUDIT_RATE
		   , SUM(A.AD_RESULT_OK) AS AD_RESULT_OK     
		   , SUM(A.AD_RESULT_NOK) AS AD_RESULT_NOK
		   , SUM(A.AD_RESULT_NA) AS AD_RESULT_NA
		   , SUM(A.AD_RESULT_PASS) AS AD_RESULT_PASS
		   , SUM(A.AD_RESULT_REQ) AS AD_RESULT_REQ
		   , SUM(A.AD_WEIGHT_TOTAL) AS AD_WEIGHT_TOTAL
		   , SUM(A.AD_WEIGHT_OK) AS AD_WEIGHT_OK
		   , SUM(A.AD_WEIGHT_NOK) AS AD_WEIGHT_NOK 
		   , SUM(A.AD_WEIGHT_PASS) AS AD_WEIGHT_PASS
		   , SUM(A.AD_WEIGHT_NA) AS AD_WEIGHT_NA  
		   , SUM(A.AD_WEIGHT_REQ) AS AD_WEIGHT_REQ  
		   , (
				SELECT COUNT(DISTINCT F.ASSET_CD) AS CNT
				FROM SNET_ASSET_SW_AUDIT_HISTORY C,
					 SNET_ASSET_SW_AUDIT_DAY   D,
					 SNET_ASSET_MASTER         F
			   WHERE     C.ASSET_CD = D.ASSET_CD
					 AND F.ASSET_CD = D.ASSET_CD
					 AND F.TEAM_ID IS NOT NULL
					 AND C.SW_TYPE = D.SW_TYPE
					 AND C.SW_NM = D.SW_NM
					 AND C.AUDIT_DAY = D.AUDIT_DAY
					 AND C.SW_DIR = D.SW_DIR
					 AND C.SW_USER = D.SW_USER
					 AND C.SW_ETC = D.SW_ETC
					 AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
					 AND F.BRANCH_ID = SAM.BRANCH_ID
					 AND F.TEAM_ID = SAM.TEAM_ID				 

		   ) AS ASSET_CNT
		   , 
		   (
			 SELECT 
				COUNT(*) AS CNT
            FROM SNET_ASSET_SW_AUDIT_HISTORY C,
                 SNET_ASSET_SW_AUDIT_DAY   D,
                 SNET_ASSET_MASTER         F
           WHERE     C.ASSET_CD = D.ASSET_CD
                 AND F.ASSET_CD = D.ASSET_CD
                 AND F.TEAM_ID IS NOT NULL
                 AND C.SW_TYPE = D.SW_TYPE
                 AND C.SW_NM = D.SW_NM
                 AND C.AUDIT_DAY = D.AUDIT_DAY
                 AND C.SW_DIR = D.SW_DIR
                 AND C.SW_USER = D.SW_USER
                 AND C.SW_ETC = D.SW_ETC
                 AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
				 AND F.BRANCH_ID = SAM.BRANCH_ID
			 	 AND F.TEAM_ID = SAM.TEAM_ID
		   ) AS ASSET_SW_CNT
    FROM SNET_ASSET_SW_AUDIT_HISTORY A,
         SNET_ASSET_SW_AUDIT_DAY   B,
         SNET_ASSET_MASTER         SAM
   WHERE     A.ASSET_CD = B.ASSET_CD
         AND A.ASSET_CD = SAM.ASSET_CD
         AND A.AUDIT_DAY = B.AUDIT_DAY
         AND A.SW_TYPE = B.SW_TYPE
         AND A.SW_NM = B.SW_NM
         AND A.SW_DIR = B.SW_DIR
         AND A.SW_USER = B.SW_USER
         AND A.SW_ETC = B.SW_ETC
         AND A.SW_TYPE IN ('OS', 'DB', 'WEB', 'WAS', 'URL', 'NW', 'SE')
		 AND SAM.BRANCH_ID IS NOT NULL
		 AND SAM.TEAM_ID IS NOT NULL
	GROUP BY 
		SAM.BRANCH_ID
		, SAM.TEAM_ID
	</insert>

	<select id="selectReportTeam" resultType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		SELECT
			BRANCH_ID as branchId
			, TEAM_ID as teamId
		FROM SNET_REPORT_TEAM
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</select>

	<update id="updateReportTeam" parameterType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		UPDATE SNET_REPORT_TEAM SET
		ASSET_CNT = (
			SELECT COUNT(DISTINCT F.ASSET_CD) AS CNT
				FROM SNET_ASSET_SW_AUDIT_HISTORY C,
					 SNET_ASSET_SW_AUDIT_DAY   D,
					 SNET_ASSET_MASTER         F
			   WHERE     C.ASSET_CD = D.ASSET_CD
					 AND F.ASSET_CD = D.ASSET_CD
					 AND C.SW_TYPE = D.SW_TYPE
					 AND C.SW_NM = D.SW_NM
					 AND C.AUDIT_DAY = D.AUDIT_DAY
					 AND C.SW_DIR = D.SW_DIR
					 AND C.SW_USER = D.SW_USER
					 AND C.SW_ETC = D.SW_ETC
					 AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
					 AND F.BRANCH_ID = #{branchId}
					 AND C.TEAM_ID 	= #{teamId}
		)
		, ASSET_SW_CNT = 
		(
			 SELECT 
				COUNT(*) AS CNT
				FROM SNET_ASSET_SW_AUDIT_HISTORY C,
					 SNET_ASSET_SW_AUDIT_DAY   D,
					 SNET_ASSET_MASTER         F
			   WHERE     C.ASSET_CD = D.ASSET_CD
					 AND F.ASSET_CD = D.ASSET_CD
					 AND C.SW_TYPE = D.SW_TYPE
					 AND C.SW_NM = D.SW_NM
					 AND C.AUDIT_DAY = D.AUDIT_DAY
					 AND C.SW_DIR = D.SW_DIR
					 AND C.SW_USER = D.SW_USER
					 AND C.SW_ETC = D.SW_ETC
					 AND C.SW_TYPE IN ('OS', 'DB' ,'WEB', 'WAS', 'URL', 'NW', 'SE')
					 AND F.BRANCH_ID = #{branchId}
					 AND F.TEAM_ID 	= #{teamId}
		)
		WHERE 
			CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
			AND BRANCH_ID	= #{branchId}
			AND TEAM_ID		= #{teamId}	
	</update>	
	
	<insert id="insertReportTeamSwType">
		INSERT INTO SNET_REPORT_TEAM_SW_TYPE
		(
			CDATE         
			, BRANCH_ID
			, BRANCH_NM
			, TEAM_ID
			, TEAM_NM
			, SW_TYPE
			, AUDIT_RATE 
			, AD_RESULT_OK  
			, AD_RESULT_NOK 
			, AD_RESULT_NA  
			, AD_RESULT_PASS
			, AD_RESULT_REQ
			, AD_WEIGHT_TOTAL
			, AD_WEIGHT_OK   
			, AD_WEIGHT_NOK  
			, AD_WEIGHT_PASS 
			, AD_WEIGHT_NA
			, AD_WEIGHT_REQ
			, ASSET_CNT
			, ASSET_SW_CNT
		)
		SELECT
		   TO_CHAR(SYSDATE, 'YYYYMMDD') AS CDATE
		   , SAM.BRANCH_ID
		   , (SELECT BRANCH_NM FROM SNET_CONFIG_TEAM_VIEW WHERE BRANCH_ID =SAM.BRANCH_ID AND TEAM_ID =SAM.TEAM_ID) as BRANCH_NM
		   , SAM.TEAM_ID
		   , (SELECT TEAM_NM FROM SNET_CONFIG_TEAM_VIEW WHERE BRANCH_ID =SAM.BRANCH_ID AND TEAM_ID =SAM.TEAM_ID) as TEAM_NM
		   , A.SW_TYPE
		   , ROUND(decode((SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100, 0, 0, null, 0,SUM(A.AD_WEIGHT_OK)/(SUM(A.AD_WEIGHT_TOTAL)-SUM(A.AD_WEIGHT_PASS)-SUM(A.AD_WEIGHT_NA))*100),2) AS AUDIT_RATE
		   , SUM(A.AD_RESULT_OK) AS AD_RESULT_OK     
		   , SUM(A.AD_RESULT_NOK) AS AD_RESULT_NOK
		   , SUM(A.AD_RESULT_NA) AS AD_RESULT_NA
		   , SUM(A.AD_RESULT_PASS) AS AD_RESULT_PASS
		   , SUM(A.AD_RESULT_REQ) AS AD_RESULT_REQ
		   , SUM(A.AD_WEIGHT_TOTAL) AS AD_WEIGHT_TOTAL
		   , SUM(A.AD_WEIGHT_OK) AS AD_WEIGHT_OK
		   , SUM(A.AD_WEIGHT_NOK) AS AD_WEIGHT_NOK 
		   , SUM(A.AD_WEIGHT_PASS) AS AD_WEIGHT_PASS
		   , SUM(A.AD_WEIGHT_NA) AS AD_WEIGHT_NA
		   , SUM(A.AD_WEIGHT_REQ) AS AD_WEIGHT_REQ
		   ,
		   (
				SELECT COUNT(DISTINCT C.ASSET_CD) AS CNT
				FROM SNET_ASSET_SW_AUDIT_HISTORY C,
					 SNET_ASSET_SW_AUDIT_DAY   D,
					 SNET_ASSET_MASTER         F
			   WHERE     C.ASSET_CD = D.ASSET_CD
					 AND F.ASSET_CD = D.ASSET_CD
					 AND C.SW_TYPE = D.SW_TYPE
					 AND C.SW_NM = D.SW_NM
					 AND C.AUDIT_DAY = D.AUDIT_DAY
					 AND C.SW_DIR = D.SW_DIR
					 AND C.SW_USER = D.SW_USER
					 AND C.SW_ETC = D.SW_ETC
					 AND C.SW_TYPE IN ('OS', 'DB', 'WEB', 'WAS', 'URL', 'NW', 'SE')
					 AND F.BRANCH_ID = SAM.BRANCH_ID
					 AND F.TEAM_ID = SAM.TEAM_ID	
					 AND C.SW_TYPE	= A.SW_TYPE
		   ) AS ASSET_CNT
		   ,
		   (
				SELECT COUNT(*) AS CNT 
				FROM SNET_ASSET_SW_AUDIT_HISTORY C,
					 SNET_ASSET_SW_AUDIT_DAY   D,
					 SNET_ASSET_MASTER         F
			   WHERE     C.ASSET_CD = D.ASSET_CD
					 AND F.ASSET_CD = D.ASSET_CD
					 AND C.SW_TYPE = D.SW_TYPE
					 AND C.SW_NM = D.SW_NM
					 AND C.AUDIT_DAY = D.AUDIT_DAY
					 AND C.SW_DIR = D.SW_DIR
					 AND C.SW_USER = D.SW_USER
					 AND C.SW_ETC = D.SW_ETC
					 AND C.SW_TYPE IN ('OS', 'DB', 'WEB', 'WAS', 'URL', 'NW', 'SE')
					 AND F.BRANCH_ID = SAM.BRANCH_ID
					 AND F.TEAM_ID = SAM.TEAM_ID	
					 AND C.SW_TYPE	= A.SW_TYPE	
		   ) AS ASSET_SW_CNT     
    FROM SNET_ASSET_SW_AUDIT_HISTORY A,
         SNET_ASSET_SW_AUDIT_DAY   B,
         SNET_ASSET_MASTER         SAM
   WHERE     A.ASSET_CD = B.ASSET_CD
         AND A.ASSET_CD = SAM.ASSET_CD
         AND A.AUDIT_DAY = B.AUDIT_DAY
         AND A.SW_TYPE = B.SW_TYPE
         AND A.SW_NM = B.SW_NM
         AND A.SW_DIR = B.SW_DIR
         AND A.SW_USER = B.SW_USER
         AND A.SW_ETC = B.SW_ETC
         AND A.SW_TYPE IN ('OS', 'DB', 'WEB', 'WAS', 'URL', 'NW', 'SE')
		 AND SAM.BRANCH_ID IS NOT NULL
		 AND SAM.TEAM_ID IS NOT NULL
		GROUP BY 
			SAM.BRANCH_ID
			, SAM.TEAM_ID
			, A.SW_TYPE	
	</insert>

	<select id="selectReportTeamSwType" resultType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		SELECT
			BRANCH_ID as branchId
			, TEAM_ID as teamId
			, SW_TYPE as swType
		FROM SNET_REPORT_TEAM_SW_TYPE
		WHERE CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</select>

	<update id="updateReportTeamSwType" parameterType="com.mobigen.snet.supportagent.entity.MakeReportEntity">
		UPDATE SNET_REPORT_TEAM_SW_TYPE SET
		ASSET_CNT = (
			SELECT COUNT(DISTINCT F.ASSET_CD) AS CNT
				FROM SNET_ASSET_SW_AUDIT_HISTORY C,
					 SNET_ASSET_SW_AUDIT_DAY   D,
					 SNET_ASSET_MASTER         F
			   WHERE     C.ASSET_CD = D.ASSET_CD
					 AND F.ASSET_CD = D.ASSET_CD
					 AND C.SW_TYPE = D.SW_TYPE
					 AND C.SW_NM = D.SW_NM
					 AND C.AUDIT_DAY = D.AUDIT_DAY
					 AND C.SW_DIR = D.SW_DIR
					 AND C.SW_USER = D.SW_USER
					 AND C.SW_ETC = D.SW_ETC
					 AND C.SW_TYPE IN ('OS', 'DB', 'WEB', 'WAS', 'URL', 'NW', 'SE')
					 AND F.BRANCH_ID = #{branchId}
					 AND C.TEAM_ID	= #{teamId}
					 AND C.SW_TYPE	= #{swType}	
		)
		, ASSET_SW_CNT = 
		(
			SELECT COUNT(*) AS CNT 
				FROM SNET_ASSET_SW_AUDIT_HISTORY C,
					 SNET_ASSET_SW_AUDIT_DAY   D,
					 SNET_ASSET_MASTER         F
			   WHERE     C.ASSET_CD = D.ASSET_CD
					 AND F.ASSET_CD = D.ASSET_CD
					 AND C.SW_TYPE = D.SW_TYPE
					 AND C.SW_NM = D.SW_NM
					 AND C.AUDIT_DAY = D.AUDIT_DAY
					 AND C.SW_DIR = D.SW_DIR
					 AND C.SW_USER = D.SW_USER
					 AND C.SW_ETC = D.SW_ETC
					 AND C.SW_TYPE IN ('OS', 'DB', 'WEB', 'WAS', 'URL', 'NW', 'SE')
					 AND F.BRANCH_ID = #{branchId}
					 AND C.TEAM_ID	= #{teamId}
					 AND C.SW_TYPE	= #{swType}		
		)
		WHERE 
			CDATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
			AND BRANCH_ID = #{branchId}
			AND TEAM_ID	= #{teamId}
			AND SW_TYPE	= #{swType}
	</update>
	
	<!-- Agent Status Report -->
	<delete id="deleteAgentReport">
		DELETE FROM SNET_REPORT_AGENT
		WHERE CDATE = TO_CHAR(SYSDATE, 'yyyymmdd')
	</delete>

	<!--'sg_supprotmanager 프로젝트 - 스케줄러'-->
	<insert id="makeAgentReport">
		INSERT INTO SNET_REPORT_AGENT
		(
			CDATE
			, SW_NM
			, AGENT_DAE
			, AGENT_JUN
			, AGENT_RES
			, EQUIP_CNT
			, CREATE_DATE
		) 
		SELECT 
		 	TO_CHAR(SYSDATE, 'yyyymmdd') 
			, OS_DATA.SW_NM
			, NVL(ALL_DATA.DAE, 0) AS DAE
			, NVL(ALL_DATA.JUN, 0) AS JUN
			, NVL(ALL_DATA.RES, 0) AS RES
			, NVL(OS_DATA.CNT, 0) AS EQUIP_CNT
			, SYSDATE
		 FROM 
		 (
			SELECT AD.SW_NM, COUNT(*) AS CNT
				FROM (  SELECT ASSET_CD, SW_NM, COUNT(*) AS CNT
						  FROM SNET_ASSET_SW_AUDIT_DAY
						 WHERE SW_TYPE = 'OS'
					  GROUP BY ASSET_CD, SW_NM) AD
			GROUP BY AD.SW_NM
		 ) OS_DATA
		 LEFT OUTER JOIN
		 (
		
				SELECT
					B.SW_NM
					,
					(
						SELECT COUNT(SCM.ASSET_CD) AS CNT
						 FROM SNET_CONNECT_MASTER SCM,
							  SNET_AGENT_MASTER   AM,
							  SNET_ASSET_MASTER   ASSM
						 WHERE     ASSM.ASSET_CD = SCM.ASSET_CD
							   AND ASSM.AGENT_CD = AM.AGENT_CD
							   AND SCM.CONNECT_IP_ADDRESS IS NOT NULL
							   AND AM.AGENT_REGI_FLAG = 2
							   AND AM.AGENT_TYPE = 1
							   AND LOWER(SCM.SW_NM) = LOWER(B.SW_NM)
					) AS JUN	
					,
					(
						SELECT COUNT(SCM.ASSET_CD) AS CNT
						 FROM SNET_CONNECT_MASTER SCM,
							  SNET_AGENT_MASTER   AM,
							  SNET_ASSET_MASTER   ASSM
						 WHERE     ASSM.ASSET_CD = SCM.ASSET_CD
							   AND ASSM.AGENT_CD = AM.AGENT_CD
							   AND SCM.CONNECT_IP_ADDRESS IS NOT NULL
							   AND AM.AGENT_REGI_FLAG = 2
							   AND AM.AGENT_TYPE = 2
							   AND LOWER(SCM.SW_NM) = LOWER(B.SW_NM)
					) AS DAE
					, COUNT(A.ASSET_CD) AS RES
					FROM

						(
							SELECT SCM.ASSET_CD,
									LOWER(SCM.SW_NM) AS SW_NM,
									AM.AGENT_TYPE
							 FROM SNET_CONNECT_MASTER SCM,
								  SNET_AGENT_MASTER   AM,
								  SNET_ASSET_MASTER   ASSM
							 WHERE     ASSM.ASSET_CD = SCM.ASSET_CD
								   AND ASSM.AGENT_CD = AM.AGENT_CD
								   AND SCM.CONNECT_IP_ADDRESS IS NOT NULL
								   AND AM.AGENT_TYPE = 2
								   AND AM.AGENT_REGI_FLAG = 2
						) B
						LEFT OUTER JOIN
						(
							SELECT DISTINCT ASSET_CD, AGENT_STATUS
							FROM SNET_AGENT_STATUS_HISTORY
							WHERE AGENT_STATUS = 1
							AND AGENT_STATUS_DATE >= STR_TO_DATE (date_format(NOW(), '%Y%m%d'), '%Y%m%d')
						) A
					ON(A.ASSET_CD = B.ASSET_CD)						
					GROUP BY B.SW_NM
		) ALL_DATA
		ON( LOWER(OS_DATA.SW_NM) = LOWER(ALL_DATA.SW_NM))
	</insert>
</mapper>